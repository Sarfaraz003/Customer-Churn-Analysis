#---------- CUSTOMER CHURN ANALYSIS ----------#

# The response variable of interest is churn, the total number of customers leaving each month

# Tenure - Number of months the customer has stayed with the company

#-----{Load & Explore dataset}

data=read.csv("C:\\Users\\molla\\Downloads\\archive (1)\\WA_Fn-UseC_-Telco-Customer-Churn.csv")
View(data)
head(data)
str(data)
dim(data)
summary(data) #-- On an average customers have continued their service for 32.7 months  

# Check missing values
colSums(is.na(data))
#Basic Data Cleaning
#Business Question: Are there missing values or duplicates that may affect analysis?

# Remove duplicate rows
data=unique(data)

#-----{Exploratory Data Analysis (EDA)}

#Business Questions:

#How many customers churned?
#What factors are related to churn (like contract type, tenure, monthly charges)?


# Churn distribution
table(data$Churn)

# Percentage churn
proportion = prop.table(table(data$Churn)) * 100
round(proportion,2) 

# Relationship between churn and contract type
table(data$Contract,data$Churn)

proportion=prop.table(table(data$Contract,data$Churn))*100
round(proportion,2)

# Average tenure by churn status
aggregate(tenure~Churn,data=data,mean)

#[Alternative]:

# Average tenure for churned
avg_tenure_churn=mean(data$tenure[data$Churn=="Yes"],na.rm=TRUE)

# Average tenure for non-churned
avg_tenure_nonchurn=mean(data$tenure[data$Churn=="No"],na.rm =TRUE)

avg_tenure_churn
avg_tenure_nonchurn

# 2x2 table of Churn vs Contract
table_contract=table(data$Churn,data$Contract)

# Odds ratio (M-to-M / Two-Year)
odds_ratio=(table_contract["Yes","Month-to-month"]/table_contract["No","Month-to-month"])/(table_contract["Yes","Two year"]/table_contract["No","Two year"])
odds_ratio

# Average MonthlyCharges for churned customers
avg_charges_churn=mean(data$MonthlyCharges[data$Churn=="Yes"],na.rm=TRUE)
avg_charges_churn

# Boxplot of MonthlyCharges by churn
boxplot(MonthlyCharges~Churn,data=data,main="Monthly Charges vs Churn",col=c("lightblue","pink"))


#-----{Logistic Regression Model}
#Business Question: Can we predict churn based on customer features?

model=glm(as.factor(Churn)~tenure+Contract+MonthlyCharges,data=data,family="binomial")
summary(model)

# Predicted probabilities
pred=predict(model,type="response")

# Classify churn if probability > 0.5
pred_class=ifelse(pred>0.5,"Yes","No")

View(pred_class)
View(data$Churn)

# Confusion matrix
confusion_matrix=table(Predicted=pred_class,Actual=data$Churn)
confusion_matrix

#Model Evaluation
#Business Question: How good is the model?

# Accuracy
mean(pred_class == data$Churn)
#(4628+917)/(4628+917+952+546) [Alternative: TP+TN/TP+TN+FP+FN]

# ROC curve
library(pROC)
roc_curve=roc(data$Churn,pred)
plot(roc_curve,col="blue")
auc(roc_curve)
